<?phpdefined('BASEPATH') OR exit('No direct script access allowed');?><!--<link rel="stylesheet" type="text/css" href="http://code.jquery.com/ui/1.10.0/themes/ui-lightness/jquery-ui.css"/>--><!--<script src="http://code.jquery.com/ui/1.10.0/jquery-ui.min.js" type="text/javascript"></script>--><!--<script type="text/javascript" src="http://pontikis.github.io/lib/jquery-ui_autocomplete_html/jquery.ui.autocomplete.html.js"></script>--><script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCD2xGIJMaWN7WReKZH0ZxabhGG_i58NKA&sensor=false&libraries=places"></script><script type="text/javascript" src="<?php echo base_url(); ?>js/richmarker-compiled.js"></script><script type="text/javascript">    var map;    var mapScrollEnabled = true;    var mapDraggableEnabled = true;    var userLocLat;    var userLocLon;    var eddressLat;    var eddressLon;    var wavesurfer = Object.create(WaveSurfer);    var markers = [];    $(document).ready(function () {        var isMobile = {            Android: function () {                return navigator.userAgent.match(/Android/i);            },            BlackBerry: function () {                return navigator.userAgent.match(/BlackBerry/i);            },            iOS: function () {                return navigator.userAgent.match(/iPhone|iPad|iPod/i);            },            Opera: function () {                return navigator.userAgent.match(/Opera Mini/i);            },            Windows: function () {                return navigator.userAgent.match(/IEMobile/i);            },            any: function () {                return (isMobile.Android() || isMobile.BlackBerry() || isMobile.iOS() || isMobile.Opera() || isMobile.Windows());            }        };        if (isMobile.Android()) {            $('#store_url').attr('href', 'https://play.google.com/store/apps/details?id=com.eddress');        }else if (isMobile.iOS()) {            $('#store_url').attr('href', 'https://itunes.apple.com/app/id1012242546');        } else {            $("#gettheappmenu").addClass('hidden-xs');        }        $(document)            .on('open.fndtn.offcanvas', '[data-offcanvas]', function () {                $('#off-canvas-wrap').css('overflow-y', 'hidden');            })            .on('close.fndtn.offcanvas', '[data-offcanvas]', function () {                $('#off-canvas-wrap').css('overflow-y', 'auto');            });        <?php            if(isset($eddresss))            {                echo "mapScrollEnabled = false;\n";                echo "    mapDraggableEnabled = false;\n";                echo "    $('#details_box').show();\n";                echo "    $('#show_map').show();\n";                echo "    $('#store_images').hide();\n";                echo "    $('#openinapp').addClass('visible-xs');\n";                echo "    $('#logo_image').addClass('logo-image-small');\n";            if(isset($eddresss->code))            {                echo "    $('#eddress_action_bar').show();\n";                echo "    $('#box_code').show();\n";            }             if(isset($eddresss->countryName))            {                echo "    $('#box_country').show();\n";            }            if(isset($eddresss->city))            {                echo "    $('#box_city').show();\n";            }            if(isset($eddresss->locality))            {                echo "    $('#box_locality').show();\n";            }            if(isset($eddresss->state))            {                echo "    $('#box_state').show();\n";            }            if(isset($eddresss->street))            {                echo "    $('#box_street').show();\n";            }            if(isset($eddresss->building))            {                echo "    $('#box_building').show();\n";            }            if(isset($eddresss->floor))            {                echo "    $('#box_floor').show();\n";            }            if(isset($eddresss->unit))            {                echo "    $('#box_unit').show();\n";            }            if(isset($eddresss->postalCode))            {                echo "    $('#box_zip').show();\n";            }            if(isset($eddresss->additionalInfo))            {                echo "    $('#box_moreinfo').show();\n";            }            if(isset($eddresss->phoneNumber))            {                echo "    $('#box_phone').show();\n";                echo "    $('#call_div').removeClass('nophone');\n";                echo "    $('#call_link').attr('href','tel:".$eddresss->phoneNumber."');\n";            }else{                echo "    $('#call_link').removeAttr('href');\n";            }            if(isset($eddresss->userEmail))            {                echo "    $('#box_email').show();\n";            }            if(isset($eddresss->voiceNote))            {                echo "    $('#box_audio').show();\n";            }            if(isset($eddresss->image1Url) || isset($eddresss->image2Url))            {                echo "    $('#box_photo').show();\n";                 if(isset($eddresss->image1Url))                 {                echo "    $('#box_photo1').show();\n";                 }                 if(isset($eddresss->image2Url))                 {                echo "    $('#box_photo2').show();\n";                 }            }            if(isset($eddresss->lat) && isset($eddresss->lon)){                    echo "    eddressLat=".$eddresss->lat.";\n";                    echo "    eddressLon=".$eddresss->lon.";\n";                }            if(isset($eddresss))            {                if ($eddresss->privacy != 2)                {                    echo "    addShareLinks('".$eddresss->privateCode."','".$eddresss->typeFullName."','".$eddresss->city."','".$eddresss->street."','".$eddresss->building."','".$eddresss->floor."','".$eddresss->unit."');\n";                }                else if(isset($eddresss->code))                {                   echo "    addShareLinks('".$eddresss->code."','".$eddresss->typeFullName."','".$eddresss->city."','".$eddresss->street."','".$eddresss->building."','".$eddresss->floor."','".$eddresss->unit."');\n";                }            }            }        ?>        $('#sharebox').hide();        $('#searchInput_medium').hide();        $('#loader_image').hide();        $('#close_image').hide();        $('#close_fullscreen').hide();        $('#bar-profile').hide();        $("#ajax_search_form").submit(function (e) {            e.preventDefault();            var minlength = 3;            var searchedValue = $("input#searchTextInput").val();            searchedValue = searchedValue.replace('-', '');            if (searchedValue != '' && searchedValue.length >= minlength) {                processAjax(searchedValue);            }else{                $('#code_error_msg').animate({'marginLeft': "-5px"});                $('#code_error_msg').delay(3000).animate({'marginLeft': "-245px"});                $('#code_error_msg_mobile').animate({'marginTop': "0px"});                $('#code_error_msg_mobile').delay(3000).animate({'marginTop': "-200px"});            }        });        $("#ajax_search_medium_form").submit(function (e) {            var minlength = 3;            e.preventDefault();            var searchedValue = $("input#searchTextInput_medium").val();            searchedValue = searchedValue.replace('-', '');            if (searchedValue != '' && searchedValue.length >= minlength) {                processAjax(searchedValue);            }else{                $('#code_error_msg').animate({'marginLeft': "-5px"});                $('#code_error_msg').delay(3000).animate({'marginLeft': "-245px"});                $('#code_error_msg_mobile').animate({'marginTop': "0px"});                $('#code_error_msg_mobile').delay(3000).animate({'marginTop': "-200px"});            }        });        $("#sharebyemail_form").submit(function (e) {            e.preventDefault();            var emailName = $("input#share_email_name").val();            var emailFrom = $("input#share_email_from").val();            var emailTo = $("input#share_email_to").val();            var emailBody = $("textarea#share_email_body").val();            var email_eddress_code = $("input#email_eddress_code").val();            jQuery.ajax({                type: "POST",                url: "<?php echo base_url(); ?>map/send_share_email",                dataType: 'json',                data: {                    'emailName': emailName,                    'emailFrom': emailFrom,                    'emailTo': emailTo,                    'emailBody': emailBody,                    'email_eddress_code': email_eddress_code                },                success: function (res) {                    if (res == 1) {                        $("#email_sent_failed").hide();                        $("#email_sent_success").show();                    } else {                        $("#email_sent_success").hide();                        $("#email_sent_failed").show();                    }                },                error: function (error) {                    $("#email_sent_success").hide();                    $("#email_sent_failed").show();                }            });            $("input#share_email_from").val("");            $("input#share_email_to").val("");            $("textarea#share_email_body").val("");        });    });    // Init & load audio file    document.addEventListener('DOMContentLoaded', function () {        var options = {            container: '#wave',            waveColor: '#D8D8D8',            progressColor: '#0FB6CF',            cursorWidth: 0,            hideScrollbar: true,            fillParent: true,            height: 54        };        // Init        wavesurfer.init(options);        // Load audio from URL        <?php            if(isset($eddresss->voiceNote))            {//                $audioUrl = explode("http://www.myeddress.com/", $eddresss->voiceNote);//                echo "wavesurfer.load('".base_url().$audioUrl[1]."');\n";                  echo "wavesurfer.load('".$eddresss->voiceNote."');\n";            }        ?>        // Regions        if (wavesurfer.enableDragSelection) {            wavesurfer.enableDragSelection({                color: 'rgba(0, 255, 0, 0.1)'            });        }        wavesurfer.on('finish', function () {            $('#audio_play').toggleClass("pausebutton");        });    });    $(function () {        $('#searchText').click(function () {            $('#searchText').hide();            $('#searchTextInput').focus();        });        $('#searchText_medium').click(function () {            $('#searchText_medium').hide();            $('#searchInput_medium').show();            $('#searchTextInput_medium').focus();        });        $("#searchTextInput_medium").blur(function () {            $('#searchInput_medium').hide();            $('#searchText_medium').show();        });        $('#details_body').click(function () {            if (parseInt($('#details_box').css("marginTop")) > 250) {                $('#details_box').animate(                    {                        'marginTop': "250px"                    },                    400,                    'easeOutQuart'                );                map.setOptions({'scrollwheel': false});                map.setOptions({'draggable': false});            }        });        $("#close_image").click(function (event) {            $("#searchTextInput").val('');            $('#details_box').fadeOut();            $('#details_box').animate({                'marginTop': "1000px" //moves down            }, 100);            $("#close_image").hide();            $("#loop_image").show();            $('#searchText').show();        });        $('#close_fullscreen').click(function () {            hideDetailsBox();        });        $('#audio_play').click(function () {            wavesurfer.playPause();            $('#audio_play').toggleClass("pausebutton")        });        $('#sharebox_closebtn').click(function () {            $('#sharebox').hide();        });        $('#emailpopup_closebtn').click(function () {            $('#sharebyemail_popup').hide();        });        $('#share_div').click(function () {            $('#sharebox').show();        });        $('#share_email_btn').click(function () {            $('#sharebyemail_popup').show();        });        $('#show_map').click(function () {            showDetailsBox();        });    });    function initialize() {        var mapOptions = {            zoom: 16,            scrollwheel: mapScrollEnabled,            draggable: mapDraggableEnabled,            disableDefaultUI: false,            streetViewControl: false,            mapTypeControl: true,            mapTypeControlOptions: {                style: google.maps.MapTypeControlStyle.HORIZONTAL_BAR,                position: google.maps.ControlPosition.RIGHT_BOTTOM            },            zoomControl: true,            zoomControlOptions: {                position: google.maps.ControlPosition.RIGHT_BOTTOM            },            panControl: true,            panControlOptions: {                position: google.maps.ControlPosition.RIGHT_BOTTOM            }        };        map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);        if (<?php if(isset($eddresss->lat)){echo "true";}else{echo "false";} ?> && <?php if(isset($eddresss->lon)){echo "true";}else{echo "false";} ?>)        {            addMapClickHandler();            processMap(<?php if(isset($eddresss->lat)){echo '"'.$eddresss->lat.'"';}else{echo 0;} ?>, <?php if(isset($eddresss->lon)){echo '"'.$eddresss->lon.'"';}else{echo 0;} ?>, <?php if(isset($eddresss->typeName)){echo '"'.$eddresss->typeName.'"';}else{echo 0;} ?>, <?php if(isset($eddresss->code)){echo '"'.$eddresss->code.'"';}else{echo 0;} ?>, <?php if(isset($eddresss->userFullName)){echo '"'.$eddresss->userFullName.'"';}else{echo 0;} ?>, 0);        }else{            jQuery.ajax({                type: "POST",                url: "<?php echo base_url(); ?>map/get_business_eddresses",                dataType: 'json',                success: function (res) {                    if (res != 0) {                        var i = 0;                        for (var key in res.eddressList) {                            i++;                            var publicPlace = res.eddressList[key];                            var publicPlacePos = new google.maps.LatLng(publicPlace.lat, publicPlace.lon);                            var publicPlaceIconMarker = new RichMarker({                                position: publicPlacePos,                                map: map,                                optimized: false,                                draggable: false,                                shadow: 'none',    //                            anchor: RichMarkerPosition.BOTTOM,                                content: '<div class="marker_image_map"></div>'                            });                            var div = document.createElement('DIV');                            var imageUrl = publicPlace.userImageURL;                            div.className = "profile_circle_image_map";                            div.style.cssText = "background-image: url('"+imageUrl+"')";                            var publicPlaceMarker = new RichMarker({                                map: map,                                position: publicPlacePos,                                draggable: true,                                optimized: false,                                draggable: false,                                shadow: 'none',                                content: div                            });                            if (publicPlace.name != null) {                                attachInfoWindowWithOffset(publicPlaceMarker, "<a target='_blank' href='http://edrs.co/"+publicPlace.code+"'>"+publicPlace.name+"<br>"+publicPlace.code+"</a>");                            }                            markers.push(publicPlaceIconMarker);                            markers.push(publicPlaceMarker);                        }                    } else {                    }                },                error: function (error) {                }            });        }        // Try HTML5 geolocation        getUserLocation();    }    function processAjax(searchString) {        $("#search-close-button").hide();        $("#search-loading-button").show();        $("#searchTextInput").blur();        $("#loop_image").hide();        $("#loader_image").show();        jQuery.ajax({            type: "POST",            url: "<?php echo base_url(); ?>map/user_data_submit",            dataType: 'json',            data: {'name': searchString},            success: function (res) {                if (res.message == 'valid') {                    $("#fullname").html(res.eddresss.userFullName);                    $("#fullname_bar").html(res.eddresss.userFullName);                    $("#eddress_name").html(res.eddresss.name);                    if (res.eddresss.userImageURL != null) {                        $("#user_profile_pic").css('background-image', 'url(' + res.eddresss.userImageURL + ')');                    } else {                        $("#user_profile_pic").css('background-image', 'url("<?php echo base_url(); ?>images/defaultuser.png")');                    }                    if (res.eddresss.code != null) {                        $("#eddress_action_bar").show();                        var finalcode = (res.eddresss.code).substr(0, 3) + '-' + (res.eddresss.code).substr(3);                        $("#eddress_code").html(finalcode);                        $("#eddress_code_bar").html(finalcode);                        $('#openinapplink').attr('href', 'eddress://?code=' + res.eddresss.code);                        $('#openinapplink').show();                        $('#box_code').show();                    } else {                        $('#box_code').hide();                        $("#eddress_action_bar").hide();                        $('#openinapplink').hide();                    }                    if (res.eddresss.countryName != null) {                        $("#eddress_country").html(res.eddresss.countryName);                        $('#box_country').show();                    } else {                        $('#box_country').hide();                    }                    if (res.eddresss.city != null) {                        $("#eddress_city").html(res.eddresss.city);                        $('#box_city').show();                    } else {                        $('#box_city').hide();                    }                    if (res.eddresss.locality != null) {                        $("#eddress_locality").html(res.eddresss.locality);                        $('#box_locality').show();                    } else {                        $('#box_locality').hide();                    }                    if (res.eddresss.state != null) {                        $("#eddress_state").html(res.eddresss.state);                        $('#box_state').show();                    } else {                        $('#box_state').hide();                    }                    if (res.eddresss.street != null) {                        $("#eddress_street").html(res.eddresss.street);                        $('#box_street').show();                    } else {                        $('#box_street').hide();                    }                    if (res.eddresss.building != null) {                        $("#eddress_building").html(res.eddresss.building);                        $('#box_building').show();                    } else {                        $('#box_building').hide();                    }                    if (res.eddresss.floor != null) {                        $("#eddress_floor").html(res.eddresss.floor);                        $('#box_floor').show();                    } else {                        $('#box_floor').hide();                    }                    if (res.eddresss.unit != null) {                        $("#eddress_unit").html(res.eddresss.unit);                        $('#box_unit').show();                    } else {                        $('#box_unit').hide();                    }                    if (res.eddresss.postalCode != null) {                        $("#eddress_zip").html(res.eddresss.postalCode);                        $('#box_zip').show();                    } else {                        $('#box_zip').hide();                    }                    if (res.eddresss.additionalInfo != null) {                        $("#eddress_moreinfo").html(res.eddresss.additionalInfo);                        $('#box_moreinfo').show();                    } else {                        $('#box_moreinfo').hide();                    }                    if (res.eddresss.phoneNumber != null) {                        $("#eddress_phone").html(res.eddresss.phoneNumber);                        $('#box_phone').show();                        $('#call_div').removeClass('nophone');                        $('#call_link').attr('href', 'tel:' + res.eddresss.phoneNumber);                    } else {                        $('#box_phone').hide();                        $('#call_div').addClass('nophone');                        $('#call_link').removeAttr('href');                    }                    if (res.eddresss.userEmail != null) {                        $("#eddress_email").html(res.eddresss.userEmail);                        $("#email_link").attr("href", res.eddresss.userEmail);                        $('#box_email').show();                    } else {                        $('#box_email').hide();                    }                    if (res.eddresss.typeName != null) {                        $("#directions_div").addClass("background_1_type_" + res.eddresss.typeName);                        $("#call_div").addClass("background_2_type_" + res.eddresss.typeName);                        $("#share_div").addClass("background_3_type_" + res.eddresss.typeName);                    }                    if (res.eddresss.voiceNote != null) {//                        var audioUrl = res.eddresss.voiceNote;//                        var resultAudio = audioUrl.split("http://www.myeddress.com/");//                        wavesurfer.load("<?php //echo base_url() ?>//"+resultAudio[1]);                        wavesurfer.load(res.eddresss.voiceNote);                        $('#box_audio').show();                    } else {                        $('#box_audio').hide();                    }                    if (res.eddresss.image1Url != null || res.eddresss.image2Url != null) {                        $('#box_photo').show();                        if (res.eddresss.image1Url != null) {                            $("#photo1_href").attr("href", res.eddresss.image1Url);                            $("#photo1_img").css('background-image', 'url(' + res.eddresss.image1Url + ')');                            $('#box_photo1').show();                        } else {                            $('#box_photo1').hide();                        }                        if (res.eddresss.image2Url != null) {                            $("#photo2_href").attr("href", res.eddresss.image2Url);                            $("#photo2_img").css('background-image', 'url(' + res.eddresss.image2Url + ')');                            $('#box_photo2').show();                        } else {                            $('#box_photo2').hide();                        }                    } else {                        $('#box_photo').hide();                    }                    if(res.eddresss.code != null){                        addShareLinks(res.eddresss.code,res.eddresss.typeFullName,res.eddresss.city,res.eddresss.street,res.eddresss.building,res.eddresss.floor,res.eddresss.unit);                    }                    if (res.eddresss.lat != null && res.eddresss.lon != null) {                        eddressLat = res.eddresss.lat;                        eddressLon = res.eddresss.lon;                        addMapClickHandler();                        processMap(res.eddresss.lat, res.eddresss.lon, res.eddresss.typeName, res.eddresss.code, res.eddresss.userFullName, res.eddresss.checkPoints);                        postUserLocation();                    }                    $('#details_box').fadeIn(800, function () {                        map.setOptions({'scrollwheel': false});                        map.setOptions({'draggable': false});                        map.setOptions({'mapTypeControl': false});                    });                    $('#show_map').show();                    $("#search-close-button, #loop_image, #search-button, #bar-center, #menu_button").show();                    $("#search-loading-button, #loader_image, #search-form").hide();                    $('#searchTextInput_medium').val('');                    $('#searchInput_medium').hide();                    $('#searchText_medium').show();                    $('#openinapp').addClass("visible-xs");                    $("#logo_image").addClass("logo-image-small");                } else {                    $("#search-close-button, #loop_image, #search-button, #bar-center, #menu_button").show();                    $("#search-loading-button, #loader_image, #search-form").hide();                    $('#code_error_msg').animate({'marginLeft': "-5px"});                    $('#code_error_msg').delay(3000).animate({'marginLeft': "-245px"});                    $('#code_error_msg_mobile').animate({'marginTop': "0px"});                    $('#code_error_msg_mobile').delay(3000).animate({'marginTop': "-200px"});                    $('#searchTextInput_medium').val('');                    $('#searchInput_medium').hide();                    $('#searchText_medium').show();                    if($('#openinapp').hasClass("visible-xs"))                    {                        $("#logo_image").addClass("logo-image-small");                    }else{                        $("#logo_image").removeClass("logo-image-small");                    }                }            },            error: function (error) {                $("#search-close-button, #loop_image, #search-button, #bar-center, #menu_button").show();                $("#search-loading-button, #loader_image, #search-form").hide();                $('#code_error_msg').animate({'marginLeft': "-5px"});                $('#code_error_msg').delay(3000).animate({'marginLeft': "-245px"});                $('#code_error_msg_mobile').animate({'marginTop': "0px"});                $('#code_error_msg_mobile').delay(3000).animate({'marginTop': "-200px"});                $('#searchTextInput_medium').val('');                $('#searchInput_medium').hide();                $('#searchText_medium').show();                if($('#openinapp').hasClass("visible-xs"))                {                    $("#logo_image").addClass("logo-image-small");                }else{                    $("#logo_image").removeClass("logo-image-small");                }            }        });    }    function deleteMarkers() {        for (var i = 0; i < markers.length; i++) {            markers[i].setMap(null);        }        markers = [];    }    function processMap(lat, lon, typeName, eddressCode, userFullName, checkPoints) {        deleteMarkers();        var newpos = new google.maps.LatLng(lat, lon);        map.setCenter(newpos)        var image = {            url: '<?php echo base_url(); ?>images/marker_eddress.png',            scaledSize: new google.maps.Size(35, 44)        };        marker = new google.maps.Marker({            position: newpos,            map: map,            optimized: false,            draggable: false,            icon: image        });        markers.push(marker);        var iw = new google.maps.InfoWindow({            content: eddressCode + "<br>" + userFullName        });        google.maps.event.addListener(marker, "mouseover", function (e) {            iw.open(map, this);        });        google.maps.event.addListener(marker, "mouseout", function (e) {            iw.close();        });        if (checkPoints != 0) {            for (var key in checkPoints) {                var checkpoint = checkPoints[key];                var checkpos = new google.maps.LatLng(checkpoint.lat, checkpoint.lon);                var checkpointIcon = {                    url: checkpoint.img,                    scaledSize: new google.maps.Size(32, 32),                    origin: new google.maps.Point(0, 0),                    anchor: new google.maps.Point(16, 16)                };                var checkmarker = new google.maps.Marker({                    position: checkpos,                    map: map,                    optimized: false,                    draggable: false,                    icon: checkpointIcon                });                if (checkpoint.name != null) {                    attachInfoWindow(checkmarker, checkpoint.name);                }                markers.push(checkmarker);            }        } else {            <?php                if(isset($eddresss->checkPoints)){                    $i=1;                     foreach($eddresss->checkPoints as $checkpoint)                     {                       echo ("                        var checkpos".$i." = new google.maps.LatLng(".$checkpoint->lat.",".$checkpoint->lon.");                        var checkpointIcon".$i." = {                            url: '".$checkpoint->img."',                            scaledSize: new google.maps.Size(32, 32),                            origin: new google.maps.Point(0,0),                            anchor: new google.maps.Point(16, 16)                        };                        var checkmarker".$i." = new google.maps.Marker({                            position: checkpos".$i.",                            map: map,                            optimized: false,                            draggable: false,                            icon: checkpointIcon".$i."                        });                        markers.push(checkmarker".$i."); ");                        if(isset($checkpoint->name)){                        echo ("                        var iwcheckpoint".$i." = new google.maps.InfoWindow({                            content: \"".$checkpoint->name."\"                        });                        checkmarker".$i.".addListener('click', function() {                            iwcheckpoint".$i.".open(map, this);                        });                        ");                        }                        $i++;                     }                 }             ?>        }        var middleBody = $("body").height() / 2;        var middleMap = parseInt($('#details_box').css("marginTop")) / 2;        var panDistance = middleBody / 2 - 20;        map.panBy(0, panDistance);    }    function attachInfoWindow(marker, message) {        var infowindow = new google.maps.InfoWindow({            content: message        });        marker.addListener('click', function () {            infowindow.open(marker.get('map'), marker);        });    }    function attachInfoWindowWithOffset(marker, message) {        var infowindow = new google.maps.InfoWindow({            content: message,            pixelOffset: new google.maps.Size(0, -40)        });        marker.addListener('click', function () {            infowindow.open(marker.get('map'), marker);        });    }    function addMapClickHandler() {        google.maps.event.addListener(map, 'click', function (event) {            showDetailsBox();        });    }    function showDetailsBox() {        $('#details_box').fadeOut(800, function () {            map.setOptions({'scrollwheel': true});            map.setOptions({'draggable': true});            map.setOptions({'mapTypeControl': true});        });        $('#bar-profile').addClass("visible-xs");        $('#openinapp').removeClass("visible-xs");        $('#search-button').hide();        $('#close_fullscreen').show();        $('#show_map').hide();    }    function hideDetailsBox() {        $('#details_box').fadeIn(800, function () {            map.setOptions({'scrollwheel': false});            map.setOptions({'draggable': false});            map.setOptions({'mapTypeControl': false});        });        $('#bar-profile').removeClass("visible-xs");        $('#openinapp').addClass("visible-xs");        $('#search-button').show();        $('#close_fullscreen').hide();        $('#show_map').show();    }    function getUserLocation() {        if (navigator.geolocation) {            navigator.geolocation.getCurrentPosition(function (position) {                userLocLat = position.coords.latitude;                userLocLon = position.coords.longitude;                postUserLocation();            }, function () {                getUserLocationFromIP();            },{timeout:5000});        } else {            // Browser doesn't support Geolocation            getUserLocationFromIP();        }    }    function getUserLocationFromIP() {        $.get("http://ipinfo.io", function (response) {            var userLocation = response.loc;            var commaPos = userLocation.indexOf(',');            userLocLat = parseFloat(userLocation.substring(0, commaPos));            userLocLon = parseFloat(userLocation.substring(commaPos + 1, userLocation.length));            postUserLocation();        }, "jsonp");    }    function postUserLocation() {        if (eddressLat && eddressLon) {            $("#direction_link").attr("href", "http://maps.google.com/?saddr=my location&daddr=" + eddressLat + ", " + eddressLon);        } else {            //center map based on user location            var pos = new google.maps.LatLng(userLocLat, userLocLon);            map.setCenter(pos);        }    }    function addShareLinks(eddressCode,eddressType,city,street,bldg,floor,unit) {        var lowerCode = eddressCode.toLowerCase();        var shareUrl = "http://edrs.co/"+lowerCode;        var fullEddressType = "";        var fullCity = "";        var fullStreet = "";        var fullBldg = "";        var fullFloor = "";        var fullUnit = "";        if(eddressType != null && eddressType != "") {            fullEddressType = eddressType + ": ";        }        if(city != null && city != "") {            fullCity = city + ", ";        }        if(street != null && street != "") {            fullStreet = street + ", ";        }        if(bldg != null && bldg != "") {            fullBldg = "Bldg. " + bldg + ", ";        }        if(floor != null && floor != "") {            fullFloor = "Floor " + floor + ", ";        }        if(unit != null && unit != "") {            fullUnit = "Unit " + unit + ", ";        }        var addressString = fullCity+fullStreet+fullBldg+fullFloor+fullUnit;        sharebox = $('#sharebox');        sharebox.find('.link').focus();        sharebox.find('.link').val(shareUrl);        sharebox.find('.facebook').attr('href', 'http://www.facebook.com/sharer.php?u='+shareUrl).attr('onclick', "javascript:window.open(this.href,'', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600')");        sharebox.find('.twitter').attr('href', 'https://twitter.com/intent/tweet?url='+shareUrl+'&text='+addressString).attr('onclick', "javascript:window.open(this.href,'', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600')");        sharebox.find('.googleplus').attr('href', 'https://plus.google.com/share?url='+shareUrl).attr('onclick', "javascript:window.open(this.href,'', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600')");        sharebox.find('.linkedin').attr('href', 'https://www.linkedin.com/shareArticle?mini=true&url='+shareUrl).attr('onclick', "javascript:window.open(this.href,'', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600')");        sharebox.find('.whatsapp').attr('href', 'whatsapp://send?text='+addressString+shareUrl);        sharebox.find('.facebook').click(function (e) {            e.preventDefault();        });        sharebox.find('.twitter').click(function (e) {            e.preventDefault();        });        sharebox.find('.googleplus').click(function (e) {            e.preventDefault();        });        sharebox.find('.linkedin').click(function (e) {            e.preventDefault();        });        $('.m_link').text('http://edrs.co/' + lowerCode);        $('#email_eddress_code').val('http://edrs.co/' + lowerCode);    }    google.maps.event.addDomListener(window, 'load', initialize);</script><div id="page-container" class="page-container">    <div id="map-canvas"></div>    <div id="sharebox" class="popupbox" style="display: none">        <div id="sharebox_closebtn" class="popupbox_closebtn closepopup"></div>        <div class="inner">            <br/>            <input readonly="readonly" type="text" class="link">            <div class="buttons">                <a title="Facebook" class="social facebook"></a>                <a title="Twitter" class="social twitter"></a>                <a title="Google Plus" class="social googleplus"></a>                <a title="Linked In" class="social linkedin"></a>                <a id="share_email_btn" title="Email" class="social emailmsg" style="cursor:pointer;"></a>                <a class="whatsapp visible-xs-inline-block" title="whatsapp"></a>            </div>        </div>    </div>    <div id="sharebyemail_popup" class="popup-email" style="display: none">        <div id="emailpopup_closebtn" class="closepopup"></div>        <form id="sharebyemail_form">            <label>Your name<br>                <input type="text" value="" placeholder="Enter your name here..." id="share_email_name"                       name="sender_name">            </label>            <label>Your email address<br>                <input type="email" value="" placeholder="Enter your email address here..." id="share_email_from"                       name="sender_email">            </label>            <label>Recipient email address<br>                <input type="email" placeholder="Enter recipient email here..." id="share_email_to"                       name="recipient_email">            </label>            <label>Your message<br>                <div class="message-head">                    <p>Check out this eddress</p>                    <p class="m_link"></p>                    <input type="hidden" id="email_eddress_code" name="email_eddress_code">                </div>                <textarea placeholder="Please enter your message here..." id="share_email_body"                          name="message"></textarea>            </label>            <div class="submit">                <input id="send_email_btn" type="submit" value="Send Email" class="button"><br>                <span id="email_sent_success" class="success">Your email was successfully sent.</span>                <span id="email_sent_failed" class="error">An error occurred, your email was not sent.</span>            </div>        </form>    </div>    <div class="search_box_medium hidden-xs">        <div id="searchText_medium" class="search_text_medium">            <div class="search_text_big">Search for an eddress</div>        </div>        <form id="ajax_search_medium_form" role="form" method="post" accept-charset="utf-8">            <div id="searchInput_medium" class="search_textinput_medium" style="display: none">                <input type="text" id="searchTextInput_medium" name="eddress_code"/>            </div>            <div class="search_image_medium">                <div id="loop_image">                    <input type="image" class="search_image" src="<?php echo base_url(); ?>images/loopicon.png"                           alt="Search eddress"/>                </div>                <div id='loader_image' style='display:none'>                    <img class="loading_image" src='<?php echo base_url(); ?>images/loadingiconred.gif'/>                </div>                <div id='close_image' style='display:none'>                    <img src='<?php echo base_url(); ?>images/closecircle.png'/>                </div>            </div>        </form>    </div>    <div id="code_error_msg" class="code_error_msg hidden-xs">        <span>Oops, this eddress was not found!</span>    </div>    <div id="code_error_msg_mobile" class="code_error_msg_mobile visible-xs">        <span>Oops, this eddress was not found!</span>    </div>    <div id="close_fullscreen" class="close_fullscreen" style="display: none">        <img src="<?php echo base_url(); ?>images/closecircle.png">    </div>    <div id="show_map" class="show_map_btn" style="display: none;">        SHOW MAP    </div>    <div id="details_box" class="details_box" style="display: none">        <div class="details_top">            <div id="details_body" class="details_body"></div>            <div class="details_content">                <div class="details_content_center">                    <div class="details_profile_pic">                        <div id="user_profile_pic" class="profile_circle_image"                             style='background-image: url("<?php if (isset($eddresss->userImageURL)) {                                 echo $eddresss->userImageURL;                             } else {                                 echo base_url() . 'images/defaultuser.png';                             } ?>")'></div>                    </div>                    <div class="details_eddress_code"><span id="fullname"><?php if (isset($eddresss)) echo $eddresss->userFullName ?></span></div>                    <div class="details_eddress_name"><span id="eddress_name"><?php if (isset($eddresss)) echo $eddresss->name ?></span></div>                </div>            </div>        </div>        <div class="details_bottom">            <div id="eddress_action_bar" class="row action_bar center-block" style="display: none">                <a id="direction_link" href="http://maps.google.com/?saddr=my location&daddr=<?php if (isset($eddresss))  echo $eddresss->lat; ?>,<?php if (isset($eddresss))  echo $eddresss->lon; ?>"  target="_blank">                    <div id="directions_div" class="col-xs-4 details_blue_btn <?php if (isset($eddresss->typeName)) {                        echo "background_1_type_" . $eddresss->typeName;                    } else {                        echo 0;                    } ?>">                        <div class="visible-xs action_bar_text"><img class="action_bar_icon"                                                                     src='<?php echo base_url(); ?>images/icon_directions.png'/>                        </div>                        <div class="visible-xs action_bar_text top2"><span>DIRECTIONS</span></div>                        <div class="hidden-xs action_bar_text"><img class="action_bar_icon"                                                                    src='<?php echo base_url(); ?>images/icon_directions.png'/><span>DIRECTIONS</span>                        </div>                    </div>                </a>                <a id="call_link">                    <div id="call_div" class="nophone col-xs-4 details_blue_btn <?php if (isset($eddresss->typeName)) {                        echo "background_2_type_" . $eddresss->typeName;                    } else {                        echo 0;                    } ?>">                        <div class="visible-xs action_bar_text"><img class="action_bar_icon"                                                                     src='<?php echo base_url(); ?>images/icon_phone.png'/>                        </div>                        <div class="visible-xs action_bar_text top2"><span>CALL</span></div>                        <div class="hidden-xs action_bar_text"><img                                src='<?php echo base_url(); ?>images/icon_phone.png'/><span>CALL</span></div>                    </div>                </a>                <div id="share_div" class="col-xs-4 details_blue_btn <?php if (isset($eddresss->typeName)) {                    echo "background_3_type_" . $eddresss->typeName;                } else {                    echo 0;                } ?>">                    <div class="visible-xs action_bar_text"><img class="action_bar_icon"                                                                 src='<?php echo base_url(); ?>images/icon_share.png'/>                    </div>                    <div class="visible-xs action_bar_text top2"><span>SHARE</span></div>                    <div class="hidden-xs action_bar_text"><img class="action_bar_icon"                                                                src='<?php echo base_url(); ?>images/icon_share.png'/><span>SHARE</span>                    </div>                </div>            </div>            <div id="box_audio" class="audio_box center-block" style="display: none">                <div class="col-xs-5 audio_note boldtext eddress_label">AUDIO NOTE</div>                <div class="col-xs-7">                    <div id="wave"></div>                    <div id="audio_play" class="playbutton"></div>                </div>            </div>            <div id="box_code" class="address_info center-block" style="display: none">                <!--<div class="row">                    <div class="col-xs-5 boldtext eddress_label">EDDRESS CODE</div>                    <div class="col-xs-7"><span                            id="eddress_code" class="eddress_label"><?php if (isset($eddresss)) echo $eddresss->code; ?></span>                    </div>                </div>                <div id="box_country" class="row top5" style="display: none">                    <div class="col-xs-5 boldtext eddress_label">COUNTRY</div>                    <div class="col-xs-7"><span                            id="eddress_country"><?php if (isset($eddresss)) echo $eddresss->countryName ?></span></div>                </div>                <div id="box_state" class="row top5" style="display: none">                    <div class="col-xs-5 boldtext eddress_label">STATE</div>                    <div class="col-xs-7"><span                            id="eddress_state"><?php if (isset($eddresss)) echo $eddresss->state ?></span></div>                </div>                <div id="box_city" class="row top5" style="display: none">                    <div class="col-xs-5 boldtext eddress_label">CITY</div>                    <div class="col-xs-7"><span                            id="eddress_city"><?php if (isset($eddresss)) echo $eddresss->city ?></span></div>                </div>-->                <div id="box_locality" class="row top5" style="display: none">                    <div class="col-xs-5 boldtext eddress_label"><span>AREA</span></div>                    <div class="col-xs-7 eddress_value"><span id="eddress_locality"><?php if (isset($eddresss)) echo $eddresss->locality ?></span></div>                </div>                <div id="box_street" class="row top5" style="display: none">                    <div class="col-xs-5 boldtext eddress_label">STREET</div>                    <div class="col-xs-7 eddress_value"><span id="eddress_street"><?php if (isset($eddresss)) echo $eddresss->street ?></span></div>                </div>                <div id="box_building" class="row top5" style="display: none">                    <div class="col-xs-5 boldtext eddress_label">BUILDING</div>                    <div class="col-xs-7 eddress_value"><span id="eddress_building"><?php if (isset($eddresss)) echo $eddresss->building ?></span></div>                </div>                <div id="box_floor" class="row top5" style="display: none">                    <div class="col-xs-5 boldtext eddress_label">FLOOR</div>                    <div class="col-xs-7 eddress_value"><span id="eddress_floor"><?php if (isset($eddresss)) echo $eddresss->floor ?></span></div>                </div>                <div id="box_unit" class="row top5" style="display: none">                    <div class="col-xs-5 boldtext eddress_label">UNIT</div>                    <div class="col-xs-7 eddress_value"><span id="eddress_unit"><?php if (isset($eddresss)) echo $eddresss->unit ?></span></div>                </div>                <div id="box_zip" class="row top5" style="display: none">                    <div class="col-xs-5 boldtext eddress_label">ZIP CODE</div>                    <div class="col-xs-7 eddress_value"><span id="eddress_zip"><?php if (isset($eddresss)) echo $eddresss->postalCode ?></span></div>                </div>                <div id="box_phone" class="row top5" style="display: none">                    <div class="col-xs-5 boldtext eddress_label">PHONE</div>                    <div class="col-xs-7 eddress_value"><span id="eddress_phone"><?php if (isset($eddresss)) echo $eddresss->phoneNumber ?></span></div>                </div>                <!--<div id="box_email" class="row top5" style="display: none">                    <div class="col-xs-5 boldtext eddress_label">EMAIL</div>                    <div class="col-xs-7"><a id="email_link" href="mailto:<?php if (isset($eddresss)) echo $eddresss->userEmail ?>"><span id="eddress_email"><?php if (isset($eddresss)) echo $eddresss->userEmail ?></span></a></div>                </div> -->                <div id="box_moreinfo" class="row top5" style="display: none">                    <div class="col-xs-5 boldtext eddress_label">MORE INFO</div>                    <div class="col-xs-7 eddress_value"><span id="eddress_moreinfo"><?php if (isset($eddresss)) echo $eddresss->additionalInfo ?></span>                    </div>                </div>            </div>            <div id="box_photo" class="photo_box" style="display: none">                <ul class="row">                    <li id="box_photo1" class="col-sm-6" style="display: none"><a id="photo1_href"                                                                                  href="<?php if (isset($eddresss->image1Url)) echo $eddresss->image1Url ?>"                                                                                  data-lightbox="userimages">                            <div id="photo1_img" class="photo_display"                                 style='<?php if (isset($eddresss->image1Url)) echo "background-image: url(" . $eddresss->image1Url . ")" ?>'></div>                        </a></li>                    <li id="box_photo2" class="col-sm-6" style="display: none"><a id="photo2_href"                                                                                  href="<?php if (isset($eddresss->image2Url)) echo $eddresss->image2Url ?>"                                                                                  data-lightbox="userimages">                            <div id="photo2_img" class="photo_display"                                 style='<?php if (isset($eddresss->image2Url)) echo "background-image: url(" . $eddresss->image2Url . ")" ?>'></div>                        </a></li>                </ul>            </div>        </div>    </div></div>